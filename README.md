Developing a multi-threaded kernel from scratch